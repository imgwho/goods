<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<title>shopOrder</title>
<style>
body
{
	margin:0;
	background-color:#f0f0f2;
	font-family: sans-serif; 
	overflow: hidden; /* this is important to prevent the whole page to bounce FOR iScorll */  
}
.table_menu
{
	z-index:2; position:fixed; top:45px;
}
.table_menu td
{
	width:25%; height:50px; border-right:1px solid #bbbbbb; vertical-align:middle; text-align:center; font-size:12px; background-color:#fff; z-index:2;
}
.font_orderNum
{
	font-size:18px;
}
/* LIST */
.orderGoodsFace
{
	width:100px; text-align:center; vertical-align:middle;
}
.orderGoodsFace img
{
	width:80px; height:80px;
}
.img_goodsFace
{
	width:80px; height:80px;
}
.orderGoodsModel
{
	width:100%; line-height:12px; overflow:hidden; font-size:12px; color:#979797;
}
.orderGoodsName
{
	width:100%; height:40px; line-height:40px; overflow:hidden; font-size:16px;
}
.txt_expressId
{
	padding:0px; height:30px; border-radius:0px; font-size:18px; -webkit-appearance: none; border:1px solid #bbbbbb; width:100%;
}
.div_btnSendConfirm
{
	width:80px; font-size:14px; background-color:#1AAD19; color:#fff; height:30px; line-height:30px; border-radius:3px; text-align:center; float:right; margin-right:10px; margin-top:10px;
}
/* END LIST */

/*iScorll*/
#wrapper {  
    position: absolute;  
    z-index: 1;  
    top: 95px;  
    bottom: 0px;  
    left: 0;  
    width: 100%; 
    background: #f0f0f2;  
    /*overflow: hidden; */
	height:100%;
	margin-bottom:100px;
}  
  
#scroller {
    position: absolute;  
    z-index: 1;  
    -webkit-tap-highlight-color: rgba(0,0,0,0);  
    width: 100%;  
    -webkit-transform: translateZ(0);  
    -moz-transform: translateZ(0);  
    -ms-transform: translateZ(0);  
    -o-transform: translateZ(0);  
    transform: translateZ(0);  
    -webkit-touch-callout: none;  
    -webkit-user-select: none;  
    -moz-user-select: none;  
    -ms-user-select: none;  
    user-select: none;  
    -webkit-text-size-adjust: none;  
    -moz-text-size-adjust: none;  
    -ms-text-size-adjust: none;  
    -o-text-size-adjust: none;  
    text-size-adjust: none;  
}  
  
#pullDown,#pullUp,.pulldown-tips{  
    height:40px;  
    line-height:40px;  
    text-align:center; 
	background-color:#fff; 
	color:#979797;
	font-size:12px;
	display:none;
}  
.pulldown-tips{  
	position:absolute;  
	top:-40px;  
	left:0;  
	width:100%; 
}
/*END iScorll*/
</style>
</head>
<link rel="stylesheet" type="text/css" href="css/weui.css">
<script type="text/javascript" src="js/jquery-3.1.1.min.js" ></script>
<script type="text/javascript" src="js/iscroll-probe.js"></script>
<script src="js/functionPublic.js"></script>
<body onload="init();">
<table width="100%" border="0" cellspacing="0" cellpadding="0" style="height:45px; background-color:#1AAD19; position:fixed; top:0px; z-index:8888;">
  <tr>
    <td style="width:40px; text-align:center; vertical-align:middle;" onclick="go_back();"><img src="ico/ico_back.png" style="max-width:26px;" /></td>
    <td id="td_shopName" style="text-align:center; font-size:16px; color:#fff;">店铺订单</td>
    <td id="td_shopShare" style="width:40px; vertical-align:middle; text-align:center;">&nbsp;</td>
  </tr>
</table>
<div style="width:100%; height:45px;"></div>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table_menu">
  <tr>  
    <td id="td_m1" onclick="clickWaitPay(); changeColor(1);"><font id="font_orderWaitPay" class="font_orderNum"></font><br />待付款</td>
    <td id="td_m2" onclick="clickWaitSend(); changeColor(2);"><font id="font_orderWaitSend" class="font_orderNum"></font><br />待发货</td>
    <td id="td_m3" onclick="clickHasSend(); changeColor(3);"><font id="font_orderHasSend" class="font_orderNum"></font><br />已发货</td>
    <td id="td_m4" onclick="clickHasRecive(); changeColor(4);" style="border-right:none;"><font id="font_orderHasRecive" class="font_orderNum"></font><br />已收货</td>
  </tr>
</table>

<div id="wrapper"> 
<div id="scroller">
<div id="pullDown" class=""><div class="pullDownLabel"></div></div>
<div class="pulldown-tips">下拉刷新</div>

    <div id="div_orderContent" style="margin-top:5px;">
        <div id="div_orderListWaitPay1" class="T1"></div>
        <div id="div_orderListWaitSend1"></div>
        <div id="div_orderListHasSend1"></div>
        <div id="div_orderListHasRecive1"></div>
    </div>
	<div style="width:100%; height:100px;"></div> <!--抵消wappper top:95-->
</div><!--scroller-->
</div><!--wrapper-->

</body>
</html>

<!--BEGIN ==================================================================================================================================================-->
<div id="toast" style="display: none;">
    <div class="weui_mask_transparent"></div>
    <div class="weui_toast">
        <i class="weui_icon_toast"></i>
        <p id="toastContent" class="weui_toast_content">保存成功</p>
    </div>
</div>
<div id="loadingToast" class="weui_loading_toast" style="display:none; z-index:999999;">
    <div class="weui_mask_transparent"></div>
    <div class="weui_toast">
        <div class="weui_loading">
            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
        </div>
        <p id="p_loadContent" class="weui_toast_content">正在加载</p>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialogAsk" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle"></strong></div>
        <div id="dialogContent" class="weui_dialog_bd"></div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#dialogAsk').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:shopCarDel();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialogSendConfirm" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle">询问</strong></div>
        <div id="dialogContent" class="weui_dialog_bd">是否确认发货？</div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#dialogSendConfirm').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:sendConfrim();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialogOrderDel" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle">询问</strong></div>
        <div id="dialogContent" class="weui_dialog_bd">是否确认<font style="color:red;">永久</font>删除该订单？</div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#dialogOrderDel').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:delConfirm();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialogOrderReturnDeny" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle">询问</strong></div>
        <div id="dialogContent" class="weui_dialog_bd">是否确认<font style="color:red;">拒绝</font>该退款申请？</div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#dialogOrderReturnDeny').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:returnDenyConfirm();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="dialogOrderReturnAgree" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle">询问</strong></div>
        <div id="dialogContent" class="weui_dialog_bd">是否确认<font style="color:#1AAD19;">同意</font>该退款申请？</div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#dialogOrderReturnAgree').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:returnAgreeConfirm();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_confirm" id="div_ejectFreight" style="display: none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title" id="dialogTitle">修改运费</strong></div>
        <div id="dialogContent" class="weui_dialog_bd" style="height:40px;"><input id="txt_freight" type="number" style="padding:0px; margin:0px; height:40px; border-radius:0px; width:100%; font-size:18px; -webkit-appearance: none; border:1px solid #bbbbbb;" /></div>
      <div class="weui_dialog_ft">
            <a id="dialogCancle" href="javascript:$('#div_ejectFreight').css('display','none');" class="weui_btn_dialog default">取消</a>
            <a id="dialogConfirm" href="javascript:freightEditConfirm();" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<div class="weui_dialog_alert" id="notice" style="display:none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
        <div class="weui_dialog_bd" id="noticeContent">&nbsp;</div>
        <div class="weui_dialog_ft">
            <a href="javascript:$('#notice').css('display','none');" class="weui_btn_dialog primary">确定</a>
        </div>
    </div>
</div>

<!--BEGIN actionSheetExpress-->
<div id="actionSheet_wrapExpress" style="z-index:9999; background-color:#fff; overflow:scroll;">
    <div class="weui_mask_transition" id="maskExpress"></div>
    <div class="weui_actionsheet" id="weui_actionsheetExpress" style="margin-top:60px; background-color:#fff; height:100%; overflow:scroll;">
    <div style="width:100%; height:50px;"></div>
    <div style="width:100%; background-color:#fff;">
        <div style="margin:0px 10px 0px 10px;">
            <div id="div_expName" style="font-size:20px; line-height:40px;"></div>
            <div id="div_expId" style="font-size:16px; line-height:30px; border-bottom:1px solid #bbbbbb;"></div>
            <div id="div_expContent"></div>
        </div>
        <!--<div onclick="hideExpress();" style="position:fixed; bottom:5px; width:80%; margin:0 auto; height:40px; line-height:40px; color:#333; text-align:center; font-size:14px;">关闭</div>-->
    </div>       
    </div>
</div>
<!--END actionSheetPassword-->
<!--END ==================================================================================================================================================-->

<script>
var token=GetUrlParam("token");
var result="";
var pageNo=1;
var orderId="";
var listType="waitPay";

function init()
{
	$("#loadingToast").css("display","block");
	$("#td_m1").css("color","#1AAD19");
	calcOrderWaitPay();
	calcOrderWaitSend();
	calcOrderHasSend();
	calcOrderHasRecive();
	clickWaitPay();
	//setTimeout(function(){iscorll();},500);
	//iscorll();
	setTimeout(function(){myScroll.refresh();},500);
}

function changeColor(id)
{
	for (var i=1; i<=4; i++) {
		if (parseInt(i)==parseInt(id)){
			$("#td_m"+i).css("color","#1AAD19");
		} else {
			$("#td_m"+i).css("color","#000");
		}
	}
}

function clickWaitPay()
{
	pageNo=1;
	listType="waitPay";
	$("#div_orderContent").html("<div id='div_orderListWaitPay1'></div>");	
	loadOrderWaitPay();
}

function clickWaitSend()
{
	pageNo=1;
	listType="waitSend";
	$("#div_orderContent").html("<div id='div_orderListWaitSend1'></div>");
	loadOrderWaitSend();
}

function clickHasSend()
{
	pageNo=1;
	listType="hasSend";
	$("#div_orderContent").html("<div id='div_orderListHasSend1'></div>");	
	loadOrderHasSend();
}

function clickHasRecive()
{
	pageNo=1;
	listType="hasRecive";
	$("#div_orderContent").html("<div id='div_orderListHasRecive1'></div>");	
	loadOrderHasRecive();
}

function loadOrderWaitPay()
{	
	$("#loadingToast").css("display","block");
	result="";
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=0&pageNo="+pageNo,data: {},dataType : "jsonp",async : false,
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				if (json.data.length==0 && pageNo==1) {
					$("#div_orderListWaitPay1").html("<div style='width:100%; text-align:center; margin-top:100px;'><img src='ico/ico_orderEmpty.png' style='max-height:100px; margin-bottom:10px;' /><br /><font style='font-size:14px; color:#8a8a8a;'>没有相关订单</font></div>");
					setTimeout(function(){myScroll.refresh();},500);
				} else if (json.data.length>0) {
					for (var i=0; i<json.data.length; i++) {
						
						price=parseFloat(json.data[i].price).toFixed(2);					
						ccer=parseFloat(json.data[i].zsccer).toFixed(2);
						freight=parseFloat(json.data[i].freight).toFixed(2);
						number=parseInt(json.data[i].sl);			
						priceSum=(parseFloat(price*number)+parseFloat(freight)).toFixed(2);			
						sp_img="";
						if(json.data[i].sp_img.indexOf("img_goodsFace")==-1){
							sp_img="<img class='img_goodsFace' src='"+json.data[i].sp_img+"'/>";	
						}else{
							
							sp_img=json.data[i].sp_img;
						}	
						result+="<div id='orderId'><div style='width:100%; height:40px; line-height:40px; background-color:#fff; font-size:14px; color:#333; border-bottom:1px solid #f2f2f2;'><font id='font_orderId' style='margin-left:10px;'>订单编号:"+json.data[i].orderId+"</font></div><table width='100%' border='0' cellspacing='0' cellpadding='0' height='100' bgcolor='#FFFFFF' style=' border-bottom:1px solid #f2f2f2;'><tr><td class='orderGoodsFace'>"+sp_img+"</td><td><div id='div_goodsName' class='orderGoodsName'>"+json.data[i].title+"</div><div class='orderGoodsModel'><font id='font_goodsModel'>"+json.data[i].gg+"</font>×<font id='font_goodsNum"+json.data[i].orderId+"'>"+number+"</font></div><div style='width:100%; line-height:30px;'><font id='font_goodsPrice"+json.data[i].orderId+"' style='font-size:18px; color:#1AAD19; font-weight:bold;'>"+price+"</font><font style='font-size:12px;'>碳票</font></div><div style='width:100%; line-height:30px; font-size:14px;'>附送碳:<font id='font_goodsCcer' color='#C03'>"+ccer+"</font>吨</div></td></tr></table><div style='width:100%; border-bottom:1px solid #f2f2f2; background-color:#fff;'><div style='width:100%; height:40px; line-height:46px;'><font id='font_addressName' style='font-size:18px; margin-left:10px;'>"+json.data[i].addrInfo.pname+"</font><font id='font_addressMobile' style='margin-left:10px;'>"+json.data[i].addrInfo.tel+"</font></div><div style='margin-left:10px; margin-right:10px; line-height:24px; word-break:break-all; color:#666;'><font id='font_address' style='font-size:14px;'>"+json.data[i].addrInfo.diqu+json.data[i].addrInfo.jiedao+json.data[i].addrInfo.addr+"</font></div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>运费:</font><font id='font_freight"+json.data[i].orderId+"'>"+freight+"</font>碳票<div id='div_freightEdit' style='background-color:#1AAD19; color:#fff; border-radius:3px; font-size:14px; width:50px; height:30px; line-height:30px; text-align:center; margin-top:5px; margin-right:10px; float:right;' onclick='freightEdit(&apos;"+json.data[i].orderId+"&apos;);'>修改</div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; margin-bottom:10px;'><font style='margin-left:10px;'>总价:</font><font id='font_priceSum"+json.data[i].orderId+"' style='color:#1AAD19; font-size:18px; font-weight:bold;'>"+priceSum+"</font>碳票</div></div>";	
					}
					result+="<div id='div_orderListWaitPay"+parseInt(pageNo)+1+"'></div>";
					$("#div_orderListWaitPay"+pageNo).html(result);
					setTimeout(function(){myScroll.refresh();},500);
					
					pageNo++;
				}
				setTimeout(function(){$("#loadingToast").css("display","none");},500);		
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function loadOrderWaitSend()
{	
	$("#loadingToast").css("display","block");
	result="";
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=1&pageNo="+pageNo,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				if (json.data.length==0 && pageNo==1) {
					$("#div_orderListWaitSend1").html("<div style='width:100%; text-align:center; margin-top:100px;'><img src='ico/ico_orderEmpty.png' style='max-height:100px; margin-bottom:10px;' /><br /><font style='font-size:14px; color:#8a8a8a;'>没有相关订单</font></div>");
					setTimeout(function(){myScroll.refresh();},500);
				} else if (json.data.length>0) {
					
					for (var i=0; i<json.data.length; i++) {
						
						price=parseFloat(json.data[i].price).toFixed(2);					
						ccer=parseFloat(json.data[i].zsccer).toFixed(2);
						freight=parseFloat(json.data[i].freight).toFixed(2);
						number=parseInt(json.data[i].sl);			
						priceSum=(parseFloat(price*number)+parseFloat(freight)).toFixed(2);			
						sp_img="";
						if(json.data[i].sp_img.indexOf("img_goodsFace")==-1){
							sp_img="<img class='img_goodsFace' src='"+json.data[i].sp_img+"'/>";	
						}else{
							
							sp_img=json.data[i].sp_img;
						}	
						if (json.data[i].return_status==0) 
						{
							result+="<div id='orderId"+json.data[i].orderId+"'><div style='width:100%; height:40px; line-height:40px; background-color:#fff; font-size:14px; color:#333; border-bottom:1px solid #f2f2f2;'><font id='font_orderId' style='margin-left:10px;'>订单编号:"+json.data[i].orderId+"</font></div><table width='100%' border='0' cellspacing='0' cellpadding='0' height='100' bgcolor='#FFFFFF' style=' border-bottom:1px solid #f2f2f2;'><tr><td class='orderGoodsFace'>"+sp_img+"</td><td><div id='div_goodsName' class='orderGoodsName'>"+json.data[i].title+"</div><div class='orderGoodsModel'><font id='font_goodsModel'>"+json.data[i].gg+"</font>×<font id='font_goodsNum"+json.data[i].orderId+"'>"+number+"</font></div><div style='width:100%; line-height:30px;'><font id='font_goodsPrice"+json.data[i].orderId+"' style='font-size:18px; color:#1AAD19; font-weight:bold;'>"+price+"</font><font style='font-size:12px;'>碳票</font></div><div style='width:100%; line-height:30px; font-size:14px;'>附送碳:<font id='font_goodsCcer' color='#C03'>"+ccer+"</font>吨</div></td></tr></table><div style='width:100%; border-bottom:1px solid #f2f2f2; background-color:#fff;'><div style='width:100%; height:40px; line-height:46px;'><font id='font_addressName' style='font-size:18px; margin-left:10px;'>"+json.data[i].addrInfo.pname+"</font><font id='font_addressMobile' style='margin-left:10px;'>"+json.data[i].addrInfo.tel+"</font></div><div style='margin-left:10px; margin-right:10px; line-height:24px; word-break:break-all; color:#666;'><font id='font_address' style='font-size:14px;'>"+json.data[i].addrInfo.diqu+json.data[i].addrInfo.jiedao+json.data[i].addrInfo.addr+"</font></div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>运费:</font><font id='font_freight"+json.data[i].orderId+"'>"+freight+"</font>碳票</div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff;'><font style='margin-left:10px;'>总价:</font><font id='font_priceSum"+json.data[i].orderId+"' style='color:#1AAD19; font-size:18px; font-weight:bold;'>"+priceSum+"</font>碳票</div><div class='weui_cells weui_cells_form' style='background-color:#fff; margin-top:0px;'><div class='weui_cell weui_cell_switch'><div class='weui_cell_hd weui_cell_primary' style='font-size:14px;'>无需快递</div><div class='weui_cell_ft'><input id='chk_express"+json.data[i].orderId+"' class='weui_switch' type='checkbox' onchange='noExpress(this,&apos;"+json.data[i].orderId+"&apos;);' /></div></div></div><div id='div_express"+json.data[i].orderId+"' style='width:100%; background-color:#fff;'><div style='margin-left:10px; margin-right:10px; height:20px; line-height:20px; font-size:12px;background-color:#fff;'>请填写快递单号</div><div style='margin-left:10px; margin-right:10px; height:30px; background-color:#fff;'><input id='txt_express"+json.data[i].orderId+"' class='txt_expressId' type='text'/></div></div><div style='width:100%; height:50px; background-color:#fff; margin-bottom:10px;'><div onclick='sendConfirmAsk(&apos;"+json.data[i].orderId+"&apos;);' class='div_btnSendConfirm'>确认发货</div></div></div>";
						}
						
						if (json.data[i].return_status==1) //申请退款状态
						{
							result+="<div id='orderId"+json.data[i].orderId+"'><div style='width:100%; height:40px; line-height:40px; background-color:#fff; font-size:14px; color:#333; border-bottom:1px solid #f2f2f2;'><font id='font_orderId' style='margin-left:10px;'>订单编号:"+json.data[i].orderId+"</font></div><table width='100%' border='0' cellspacing='0' cellpadding='0' height='100' bgcolor='#FFFFFF' style=' border-bottom:1px solid #f2f2f2;'><tr><td class='orderGoodsFace'>"+sp_img+"</td><td><div id='div_goodsName' class='orderGoodsName'>"+json.data[i].title+"</div><div class='orderGoodsModel'><font id='font_goodsModel'>"+json.data[i].gg+"</font>×<font id='font_goodsNum"+json.data[i].orderId+"'>"+number+"</font></div><div style='width:100%; line-height:30px;'><font id='font_goodsPrice"+json.data[i].orderId+"' style='font-size:18px; color:#1AAD19; font-weight:bold;'>"+price+"</font><font style='font-size:12px;'>碳票</font></div><div style='width:100%; line-height:30px; font-size:14px;'>附送碳:<font id='font_goodsCcer' color='#C03'>"+ccer+"</font>吨</div></td></tr></table><div style='width:100%; border-bottom:1px solid #f2f2f2; background-color:#fff;'><div style='width:100%; height:40px; line-height:46px;'><font id='font_addressName' style='font-size:18px; margin-left:10px;'>"+json.data[i].addrInfo.pname+"</font><font id='font_addressMobile' style='margin-left:10px;'>"+json.data[i].addrInfo.tel+"</font></div><div style='margin-left:10px; margin-right:10px; line-height:24px; word-break:break-all; color:#666;'><font id='font_address' style='font-size:14px;'>"+json.data[i].addrInfo.diqu+json.data[i].addrInfo.jiedao+json.data[i].addrInfo.addr+"</font></div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>运费:</font><font id='font_freight"+json.data[i].orderId+"'>"+freight+"</font>碳票</div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff;'><font style='margin-left:10px;'>总价:</font><font id='font_priceSum"+json.data[i].orderId+"' style='color:#1AAD19; font-size:18px; font-weight:bold;'>"+priceSum+"</font>碳票</div><div style='width:100%; line-height:30px; color:red; font-size:16px; background-color:#fff; border-top:1px solid #f2f2f2; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>买家申请退款</font><br /><font style='margin-left:10px;'>理由:"+json.data[i].return_reason+"</font></div><div style='width:100%; height:50px; background-color:#fff; margin-bottom:10px;'><div onclick='returnDenyAsk(&apos;"+json.data[i].orderId+"&apos;);' class='div_btnSendConfirm' style='background-color:#e84e40'>拒绝</div><div onclick='returnAgreeAsk(&apos;"+json.data[i].orderId+"&apos;);' class='div_btnSendConfirm' style='background-color:#ffa726'>同意</div></div></div>";  //最后一个</div>是最外层的
						}						
					}
					result+="<div id='div_orderListWaitSend"+parseInt(pageNo)+1+"'></div>";
					$("#div_orderListWaitSend"+pageNo).html(result);
					setTimeout(function(){myScroll.refresh();},500);

					pageNo++;
				}
				$("#loadingToast").css("display","none");				
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function loadOrderHasSend()
{	
	$("#loadingToast").css("display","block");
	result="";
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=2&pageNo="+pageNo,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				if (json.data.length==0 && pageNo==1) {
					$("#div_orderListHasSend1").html("<div style='width:100%; text-align:center; margin-top:100px;'><img src='ico/ico_orderEmpty.png' style='max-height:100px; margin-bottom:10px;' /><br /><font style='font-size:14px; color:#8a8a8a;'>没有相关订单</font></div>");
					setTimeout(function(){myScroll.refresh();},500);
				} else if (json.data.length>0) {
					for (var i=0; i<json.data.length; i++) {
						
						price=parseFloat(json.data[i].price).toFixed(2);					
						ccer=parseFloat(json.data[i].zsccer).toFixed(2);
						freight=parseFloat(json.data[i].freight).toFixed(2);
						number=parseInt(json.data[i].sl);			
						priceSum=(parseFloat(price*number)+parseFloat(freight)).toFixed(2);			
						sp_img="";
						if(json.data[i].sp_img.indexOf("img_goodsFace")==-1){
							sp_img="<img class='img_goodsFace' src='"+json.data[i].sp_img+"'/>";	
						}else{
							
							sp_img=json.data[i].sp_img;
						}	
						result+="<div id='orderId'><div style='width:100%; height:40px; line-height:40px; background-color:#fff; font-size:14px; color:#333; border-bottom:1px solid #f2f2f2;'><font id='font_orderId' style='margin-left:10px;'>订单编号:"+json.data[i].orderId+"</font></div><table width='100%' border='0' cellspacing='0' cellpadding='0' height='100' bgcolor='#FFFFFF' style=' border-bottom:1px solid #f2f2f2;'><tr><td class='orderGoodsFace'>"+sp_img+"</td><td><div id='div_goodsName' class='orderGoodsName'>"+json.data[i].title+"</div><div class='orderGoodsModel'><font id='font_goodsModel'>"+json.data[i].gg+"</font>×<font id='font_goodsNum"+json.data[i].orderId+"'>"+number+"</font></div><div style='width:100%; line-height:30px;'><font id='font_goodsPrice"+json.data[i].orderId+"' style='font-size:18px; color:#1AAD19; font-weight:bold;'>"+price+"</font><font style='font-size:12px;'>碳票</font></div><div style='width:100%; line-height:30px; font-size:14px;'>附送碳:<font id='font_goodsCcer' color='#C03'>"+ccer+"</font>吨</div></td></tr></table><div style='width:100%; border-bottom:1px solid #f2f2f2; background-color:#fff;'><div style='width:100%; height:40px; line-height:46px;'><font id='font_addressName' style='font-size:18px; margin-left:10px;'>"+json.data[i].addrInfo.pname+"</font><font id='font_addressMobile' style='margin-left:10px;'>"+json.data[i].addrInfo.tel+"</font></div><div style='margin-left:10px; margin-right:10px; line-height:24px; word-break:break-all; color:#666;'><font id='font_address' style='font-size:14px;'>"+json.data[i].addrInfo.diqu+json.data[i].addrInfo.jiedao+json.data[i].addrInfo.addr+"</font></div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>运费:</font><font id='font_freight"+json.data[i].orderId+"'>"+freight+"</font>碳票</div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; margin-bottom:10px;'><font style='margin-left:10px;'>总价:</font><font id='font_priceSum"+json.data[i].orderId+"' style='color:#1AAD19; font-size:18px; font-weight:bold;'>"+priceSum+"</font>碳票<div id='div_freightEdit' style='background-color:#f9f9f9; color:#333; border-radius:3px; font-size:14px; width:80px; height:30px; line-height:30px; text-align:center; margin-top:5px; margin-right:10px; float:right; border:1px solid #bbbbbb;' onclick='queryExpress(&apos;"+json.data[i].orderId+"&apos;);'>查看物流</div></div></div>";	
					}
					result+="<div id='div_orderListHasSend"+parseInt(pageNo)+1+"'></div>";
					$("#div_orderListHasSend"+pageNo).html(result);
					setTimeout(function(){myScroll.refresh();},500);
					pageNo++;
				}
				$("#loadingToast").css("display","none");				
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function loadOrderHasRecive()
{	
	$("#loadingToast").css("display","block");
	result="";
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=3&pageNo="+pageNo,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				if (json.data.length==0 && pageNo==1) {
					$("#div_orderListHasRecive1").html("<div style='width:100%; text-align:center; margin-top:100px;'><img src='ico/ico_orderEmpty.png' style='max-height:100px; margin-bottom:10px;' /><br /><font style='font-size:14px; color:#8a8a8a;'>没有相关订单</font></div>");
					setTimeout(function(){myScroll.refresh();},500);
				} else if (json.data.length>0) {
					for (var i=0; i<json.data.length; i++) {
						
						price=parseFloat(json.data[i].price).toFixed(2);					
						ccer=parseFloat(json.data[i].zsccer).toFixed(2);
						freight=parseFloat(json.data[i].freight).toFixed(2);
						number=parseInt(json.data[i].sl);			
						priceSum=(parseFloat(price*number)+parseFloat(freight)).toFixed(2);			
						sp_img="";
						if(json.data[i].sp_img.indexOf("img_goodsFace")==-1){
							sp_img="<img class='img_goodsFace' src='"+json.data[i].sp_img+"'/>";	
						}else{
							
							sp_img=json.data[i].sp_img;
						}	
						result+="<div id='orderId"+json.data[i].orderId+"'><div style='width:100%; height:40px; line-height:40px; background-color:#fff; font-size:14px; color:#333; border-bottom:1px solid #f2f2f2;'><font id='font_orderId' style='margin-left:10px;'>订单编号:"+json.data[i].orderId+"</font><img onclick='orderDelAsk(&apos;"+json.data[i].orderId+"&apos;);' src='ico/ico_del.png' style='max-height:26px; float:right; margin-top:7px; margin-right:10px;' /></div><table width='100%' border='0' cellspacing='0' cellpadding='0' height='100' bgcolor='#FFFFFF' style=' border-bottom:1px solid #f2f2f2;'><tr><td class='orderGoodsFace'>"+sp_img+"</td><td><div id='div_goodsName' class='orderGoodsName'>"+json.data[i].title+"</div><div class='orderGoodsModel'><font id='font_goodsModel'>"+json.data[i].gg+"</font>×<font id='font_goodsNum"+json.data[i].orderId+"'>"+number+"</font></div><div style='width:100%; line-height:30px;'><font id='font_goodsPrice"+json.data[i].orderId+"' style='font-size:18px; color:#1AAD19; font-weight:bold;'>"+price+"</font><font style='font-size:12px;'>碳票</font></div><div style='width:100%; line-height:30px; font-size:14px;'>附送碳:<font id='font_goodsCcer' color='#C03'>"+ccer+"</font>吨</div></td></tr></table><div style='width:100%; border-bottom:1px solid #f2f2f2; background-color:#fff;'><div style='width:100%; height:40px; line-height:46px;'><font id='font_addressName' style='font-size:18px; margin-left:10px;'>"+json.data[i].addrInfo.pname+"</font><font id='font_addressMobile' style='margin-left:10px;'>"+json.data[i].addrInfo.tel+"</font></div><div style='margin-left:10px; margin-right:10px; line-height:24px; word-break:break-all; color:#666;'><font id='font_address' style='font-size:14px;'>"+json.data[i].addrInfo.diqu+json.data[i].addrInfo.jiedao+json.data[i].addrInfo.addr+"</font></div></div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; border-bottom:1px solid #f2f2f2;'><font style='margin-left:10px;'>运费:</font><font id='font_freight"+json.data[i].orderId+"'>"+freight+"</font>碳票</div><div style='width:100%; height:40px; line-height:40px; font-size:14px; background-color:#fff; margin-bottom:10px;'><font style='margin-left:10px;'>总价:</font><font id='font_priceSum"+json.data[i].orderId+"' style='color:#1AAD19; font-size:18px; font-weight:bold;'>"+priceSum+"</font>碳票<div id='div_freightEdit' style='background-color:#f9f9f9; color:#333; border-radius:3px; font-size:14px; width:80px; height:30px; line-height:30px; text-align:center; margin-top:5px; margin-right:10px; float:right; border:1px solid #bbbbbb;' onclick='commentView(&apos;"+json.data[i].spId+"&apos;);'>查看评价</div></div></div>";	
					}
					result+="<div id='div_orderListHasRecive"+parseInt(pageNo)+1+"'></div>";
					$("#div_orderListHasRecive"+pageNo).html(result);
					setTimeout(function(){myScroll.refresh();},500);
					pageNo++;
				}
				$("#loadingToast").css("display","none");				
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function commentView(goodsId)
{
	window.location="mall_comment.html?goodsId="+goodsId;
}

function sendConfrim()
{	
	$("#loadingToast").css("display","block");
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/setDeliverGoods?callback=?&token="+token+"&orderId="+orderId+"&expNo="+$("#txt_express"+orderId).val(),data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#dialogSendConfirm").css("display","none");
				$("#orderId"+orderId).css("display","none");
				$("#loadingToast").css("display","none");
				
				$("#toastContent").html("发货成功");
				$("#toast").css("display","block");
				
				$("#font_orderWaitSend").html(parseInt($("#font_orderWaitSend").html())-1);
				$("#font_orderHasSend").html(parseInt($("#font_orderHasSend").html())+1);
				
				setTimeout(function(){$("#toast").css("display","none");},1000);
			}
			else
			{
				$("#loadingToast").css("display","none");
				$("#dialogSendConfirm").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});	
}

function orderDelAsk(oId)
{
	$("#dialogOrderDel").css("display","block");
	orderId=oId
}

function returnDenyAsk(oId)
{
	$("#dialogOrderReturnDeny").css("display","block");
	orderId=oId
}

function returnAgreeAsk(oId)
{
	$("#dialogOrderReturnAgree").css("display","block");
	orderId=oId
}

function sendConfirmAsk(oId)
{
	expressId=$.trim($("#txt_express"+oId).val());
	if ($("#chk_express"+oId).is(":checked")==false && expressId=="")
	{
		jectNotice("请填写快递单号");
		return;
	}
	orderId=oId;
	$("#dialogSendConfirm").css("display","block");
}

function noExpress(obj,oId)
{
	if ($(obj).is(":checked")==true){
		$("#div_express"+oId).css("display","none"); 
		$("#txt_express"+oId).val("");
	} else {
		$("#div_express"+oId).css("display","block");
	}
}

function freightEdit(oId)
{
	orderId=oId;
	$("#txt_freight").val("0.00");
	$("#div_ejectFreight").css("display","block");
}

function freightEditConfirm()
{
	$("#loadingToast").css("display","block");
	
	freight=$("#txt_freight").val();
	if (freight==""){ return; }
		
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/changeFreight?callback=?&token="+token+"&orderId="+orderId+"&freight="+freight,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				price=parseFloat($("#font_goodsPrice"+orderId).html());
				number=parseInt($("#font_goodsNum"+orderId).html());
				priceSum=parseFloat(price*number)+parseFloat(freight);
				
				$("#font_freight"+orderId).html(parseFloat(freight).toFixed(2));
				$("#font_priceSum"+orderId).html(parseFloat(priceSum).toFixed(2));	
						
				$("#div_ejectFreight").css("display","none");
				$("#loadingToast").css("display","none");
				
				$("#toastContent").html("修改成功");
				$("#toast").css("display","block");
				setTimeout(function(){$("#toast").css("display","none");},1000);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function delConfirm()
{
	$("#loadingToast").css("display","block");
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/hideOrderToJSON?callback=?&token="+token+"&orderId="+orderId,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){				
				$("#loadingToast").css("display","none");
				$("#dialogOrderDel").css("display","none");
				$("#orderId"+orderId).css("display","none");
				
				$("#font_orderHasRecive").html(parseInt($("#font_orderHasRecive").html())-1);
				
				$("#toastContent").html("删除成功");
				$("#toast").css("display","block");
				
				setTimeout(function(){$("#toast").css("display","none");},1000);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function calcOrderWaitPay()
{
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=0&page=0",data: {},dataType : "jsonp",	//默认收货地址
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#font_orderWaitPay").html(json.data.length);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function calcOrderWaitSend()
{
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=1&page=0",data: {},dataType : "jsonp",	//默认收货地址
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#font_orderWaitSend").html(json.data.length);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function calcOrderHasSend()
{
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=2&page=0",data: {},dataType : "jsonp",	//默认收货地址
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#font_orderHasSend").html(json.data.length);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function calcOrderHasRecive()
{
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/getOrdersToJSON?callback=?&token="+token+"&type=0&status=3&page=0",data: {},dataType : "jsonp",	//默认收货地址
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#font_orderHasRecive").html(json.data.length);
				setTimeout(function(){$("#loadingToast").css("display","none");},500);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function go_back()
{
	history.go(-1);
}

function queryExpress(oId)
{
	$("#loadingToast").css("display","block");
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/ship/getShipperInfoToJSOP?callback=?&orderId="+oId,data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#div_expName").html(json.data.shipName+"<img onclick='hideExpress();' src='ico/ico_close_8a.png' style='float:right; margin-right:10px; max-height:30px; margin-top:15px;' />");
				$("#div_expId").html(json.data.expNo);
				var expNumber=json.data.traces.length;
				var result="";

				for (var i=parseInt(expNumber)-1; i>=0; i--){
					result+="<div style='line-height:28px; font-size:14px; color:#8a8a8a;'>"+json.data.traces[i].AcceptTime+"</div><div style='line-height:28px; font-size:14px; color:#333333; border-bottom:1px solid #f2f2f2;'>"+json.data.traces[i].AcceptStation+"</div>";
				}
				$("#div_expContent").html(result);
				$("#loadingToast").css("display","none");
				showExpress();				
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});			
}

function returnDenyConfirm()
{
	$("#loadingToast").css("display","block");
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/setOrderReturnBySale?callback=?&token="+token+"&orderId="+orderId+"&status=3",data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#dialogOrderReturnDeny").css("display","none");
				$("#loadingToast").css("display","none");
				$("#toastContent").html("已拒绝");
				$("#toast").css("display","block");				
				clickWaitSend();				
				setTimeout(function(){$("#toast").css("display","none");},1000);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function returnAgreeConfirm()
{
	$("#loadingToast").css("display","block");
	$.ajax	
	({
		type : "POST",url:"http://114.55.103.71:9006/ldy/order/setOrderReturnBySale?callback=?&token="+token+"&orderId="+orderId+"&status=2",data: {},dataType : "jsonp",
		success : function(data) 
		{   
			var json = eval(data); 	
			if (json.code==200){
				$("#dialogOrderReturnAgree").css("display","none");
				$("#loadingToast").css("display","none");
				$("#toastContent").html("已同意");
				$("#toast").css("display","block");				
				clickWaitSend();				
				setTimeout(function(){$("#toast").css("display","none");},1000);
			}
			else
			{
				$("#loadingToast").css("display","none");
				jectNotice(json.msg);
			}
		},
		error : function(textStatus) 
		{
			$("#loadingToast").css("display","none");
		}
	});		
}

function bodyScroll(event){   event.preventDefault();  }

function showExpress() 
{
	var maskExpress = $('#maskExpress');
	var weuiActionsheetExpress = $('#weui_actionsheetExpress');
	weuiActionsheetExpress.addClass('weui_actionsheet_toggle');
	maskExpress.show().addClass('weui_fade_toggle').click(function() {
		weuiActionsheetExpress(weuiActionsheetExpress, maskExpress);
	});
	weuiActionsheetExpress.unbind('transitionend').unbind('webkitTransitionEnd');
	document.body.removeEventListener('touchmove',bodyScroll,false);	
}

function hideExpress() {
	var maskExpress = $('#maskExpress');
	var weuiActionsheetExpress = $('#weui_actionsheetExpress');

	weuiActionsheetExpress.removeClass('weui_actionsheet_toggle');
	maskExpress.removeClass('weui_fade_toggle');
	weuiActionsheetExpress.on('transitionend', function() {
		maskExpress.hide();
	}).on('webkitTransitionEnd',
		function() {
			maskExpress.hide();
		})
	document.body.addEventListener('touchmove',bodyScroll, false); 
}



//function iscorll () {  
	var myScroll,
	pullDown = $("#pullDown"),  
	pullDownLabel = $(".pullDownLabel"),  

	loadingStep = 0;//加载状态0默认，1显示加载状态，2执行加载数据，只有当为0时才能再次加载，这是防止过快拉动刷新  
//  
	pullDown.hide();  
 
	myScroll = new IScroll("#wrapper", {  
		preventDefault:false,
		scrollbars: false,  
		mouseWheel: false,  
		interactiveScrollbars: true,  
		shrinkScrollbars: 'scale',  
		fadeScrollbars: true,  
		scrollY:true,  
		probeType: 2,  
		bindToWrapper:true  
	}); 
		
	myScroll.on("scroll",function(){  
		if(loadingStep == 0 && !pullDown.attr("class").match('refresh|loading')){  
			if(this.y > 40){//下拉刷新操作  
				$(".pulldown-tips").hide();  
				pullDown.addClass("refresh").show();  
				pullDownLabel.text("松手刷新数据");  
				loadingStep = 1;  
				myScroll.refresh();
			}else if(this.y < (this.maxScrollY - 60)){//上拉加载更多  
				loadingStep = 1;  
				$("#p_loadContent").html("正在加载");
				$("#loadingToast").css("display","block");
				pullUpAction();  
			}  
		}  
	});  
	myScroll.on("scrollEnd",function(){  
		if(loadingStep == 1){  
			if( pullDown.attr("class").match("refresh") ){//下拉刷新操作  
				pullDown.removeClass("refresh").addClass("loading");  
				$("#p_loadContent").html("正在刷新");
				$("#loadingToast").css("display","block");
				loadingStep = 2;  
				pullDownAction();  
			}  
		}  
	});  

	function pullDownAction(){  
		setTimeout(function(){  
			if (listType=="waitPay") {
				clickWaitPay();
			} else if (listType=="waitSend") {
				clickWaitSend();
			} else if (listType=="hasSend") {
				clickHasSend();
			} else if (listType=="hasRecive") {
				clickHasRecive();
			}
			pullDown.attr('class','').hide();  
			loadingStep = 0;  
			$(".pulldown-tips").show(); 
			$("#loadingToast").css("display","none");
		},500);  
		setTimeout(function(){myScroll.refresh();},1000);
	}		
	function pullUpAction(){  
		setTimeout(function(){  
			loadingStep = 0;  
//			loadGoods();
			if (listType=="waitPay") {
				loadOrderWaitPay();
			} else if (listType=="waitSend") {
				loadOrderWaitSend();
			} else if (listType=="hasSend") {
				loadOrderHasSend();
			} else if (listType=="hasRecive") {
				loadOrderHasRecive();
			}
		},500);  
		setTimeout(function(){myScroll.refresh();},1000);
	}  
  
    document.body.addEventListener('touchmove',bodyScroll, false);  
//} 
</script>