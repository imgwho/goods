<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
	</head>
	<link rel="stylesheet" type="text/css" href="css/weui.css">
	<script type="text/javascript" src="js/jquery-3.1.1.min.js" ></script>
	<script type="text/javascript" src="js/iscroll-probe.js"></script>
	<script src="js/functionPublic.js"></script>
	<style>
		body{
			background: #f2f2f0;
		}
		/*碳邮票列表样式*/
		.table_carbonStamp{
			width:100%; border: none; margin-bottom: 5px;
		}
		.td_carbonStamp{
			width: 50%; background-color: #FFFFFF; border: 1px solid #CCCCCC;
		}		
		.div_carbonStampImg{
			width: 100%; text-align: left; position: relative;
		}
		.div_carbonStampImg img{
			max-width: 100%;
		}
		.div_carbonStampBgBottom{
			position: absolute; width: 100%; height: 50px; bottom: 0px; opacity: 0.7; background-color: #000;
		}
		.div_carbonStampTitle{
			position: absolute; margin-left: 10px; margin-right: 10px; height: 30px; line-height: 30px; bottom: 20px; color: #FFFFFF; font-size: 14px; overflow: hidden;
		}
		.div_carbonStampNumberType{
			position: absolute; width:100%; height: 20px; line-height: 15px; bottom: 0px; color: #FFFFFF; font-size: 12px; overflow: hidden;
		}
		.font_carbonStampNumber{
			float: left; margin-left: 10px;
		}
		.font_carbonStampType{
			float: right; margin-right: 10px;
		}
		.div_carbonStampAmount{
			width: 95%; height: 50px;
		}	
		.div_carbonStampBuySale{
			width: 99%; height: 25px; line-height: 25px; margin-left: 10px; font-size: 14px;
		}
		.font_carbonStampBuyAmount{
			font-size: 16px; font-weight: bold; color: #B12D1E; margin-right: 5px; margin-left: 5px;
		}
		.font_carbonStampSaleAmount{
			font-size: 16px; font-weight: bold; color: #1AAD19; margin-right: 5px; margin-left: 5px;
		}
		/*END 碳邮票列表样式*/
		.cssDivUserLogo{
			width: 100%; height: auto; text-align: center; background: #F9F9F9;
		}
		.cssDivUserLogo img{
			height: 80px; width: 80px; border-radius: 50%;
		}
		.tdShopCover{
			width: 33%; text-align: center; vertical-align: middle;
		}
		.tdShopCover img{
			vertical-align: middle;
		}
		.cssDivSpaceCircle{
			width: 100%; height: 60px; border-bottom: 1px solid #E8E8E8; background: #FFFFFF;
		}
		.cssDivSpaceCircle img{
			width: 50px; height: 50px; border-radius: 50%; margin-top: 5px; margin-left: 10px; float: left;
		}		
		.cssDivSpaceCircleName{
			width: auto; height: 60px; line-height: 60px; float: left; margin-left: 10px;
		}
		.cssDivSpaceCircleMebmer{
			width: auto; height: 60px; line-height: 60px; float: left; margin-left: 10px; font-size: 14px; color: #979797;
		}			
	</style>
	<body onload="init();">
		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="height:45px; background-color:#1AAD19; position:fixed; top:0px; z-index:8888;">
			<tr>
				<td style="width:40px; text-align:center;" onclick="go_back()"><img src="ico/ico_back.png" style="max-width:26px; margin-top: 7px;" /></td>
				<td id="td_shopName" style="text-align:center; font-size:16px; color:#fff;">用户空间</td>
				<td id="td_shopShare" style="width:40px; text-align:center; font-size:12px; color:#fff;"><img src="ico/ico_share_fff.png" style="max-height: 24px; margin-top: 10px;" onclick="shareSdk();" /></td>
			</tr>
		</table>
		<div style="width: 100%; height: 60px; background: #F9F9F9;"></div>
		<div class="cssDivUserLogo">
			<img id="imgUserlogo" src="" />
			<div style="width: 100%; height: auto; text-align: center; font-size: 14px;" id="divUserNickname">&nbsp;</div>
		</div>
		<div style="width: 100%; height: 40px; background: #f9f9f9; border-top: 1px solid #E8E8E8; border-bottom: 1px solid #CCCCCC;">
			<div style="width: auto; height: 40px; line-height: 40px; text-align: center; font-size: 14px; border-radius: 3px; float: left; margin-left: 10px;">信用值:</div>
			<div style="width: auto; height: 40px; line-height: 40px; text-align: center; font-size: 18px; border-radius: 3px; float: left; margin-left: 5px; color: #F90;" id="div_creditUser">&nbsp;</div>			
			<div style="width: auto; height: 40px; line-height: 40px; text-align: center; font-size: 14px; border-radius: 3px; float: right; margin-right: 10px;" id="divChat">发消息</div>
			<div id="divSpaceAddFriend" style="width: auto; height: 40px; line-height: 40px; text-align: center; font-size: 14px; border-radius: 3px; float: right; margin-right: 30px; display: none;">加好友</div>
		</div>
		
		<div style="width: 100%; height: 40px; margin-top: 5px; border-top: 1px solid #E8E8E8; border-bottom: 1px solid #E8E8E8; background: #FFFFFF;" onclick="goUserCarbonShop();">
			<img src="ico/ico_more_444.png" style="max-height: 16px; margin-top: 12px; float: right; margin-right: 10px;" />
			<img src="ico/ico_carbonShop_8a.png" style="max-height: 20px; margin-top: 10px; float: left; margin-left: 10px;" />
			<div style="width: auto; height: 40px; line-height: 40px; font-size: 14px; float: left; margin-left: 10px;">碳铺</div>
		</div>
		<div id="divCarbonShopContent">
			<!--<table width='100%' border='0' cellspacing='0' cellpadding='0'>
				<tr>
					<td class='td_carbonStamp' onclick='go_project();'>
						<div class='div_carbonStampImg' id='div_carbonStampLeft'>
							<img src='img/ccer1.png' />
							<div class='div_carbonStampBgBottom'></div>
							<div class='div_carbonStampTitle' id='div_carbonStampTitleLeft'>龙里马郎坡风电场项目</div>
							<div class='div_carbonStampNumberType'>
								<font class='font_carbonStampNumber' id='font_carbonStampNumberLeft'>LDY0426</font>
								<font class='font_carbonStampType' id='font_carbonStampTypeLeft'>风电</font>
							</div>
						</div>
						<div class='div_carbonStampAmount'>
							<div class='div_carbonStampBuySale'>转让:<font class='font_carbonStampBuyAmount' id='font_carbonStampBuyAmountLeft'>200</font>吨</div>
							<div class='div_carbonStampBuySale'>收购:<font class='font_carbonStampSaleAmount' id='font_carbonStampBuyAmountLeft'>300</font>吨</div>
						</div>
					</td>
					<td class='td_carbonStamp' onclick='go_project();'>
						<div class='div_carbonStampImg' id='div_carbonStampRight'>
							<img src='img/ccer2.png' />
							<div class='div_carbonStampBgBottom'></div>
							<div class='div_carbonStampTitle' id='div_carbonStampTitleRight'>龙里马郎坡风电场项目</div>
							<div class='div_carbonStampNumberType'>
								<font class='font_carbonStampNumber' id='font_carbonStampNumberRight'>LDY0426</font>
								<font class='font_carbonStampType' id='font_carbonStampTypeRight'>风电</font>
							</div>
						</div>
						<div class='div_carbonStampAmount'>
							<div class='div_carbonStampBuySale'>转让:<font class='font_carbonStampBuyAmount' id='font_carbonStampBuyAmountRight'>200</font>吨</div>
							<div class='div_carbonStampBuySale'>收购:<font class='font_carbonStampSaleAmount' id='font_carbonStampBuyAmountRight'>300</font>吨</div>						
						</div>
					</td>
				</tr>
			</table>-->
		</div>
		
		
		<div style="width: 100%; height: 40px; margin-top: 5px; border-top: 1px solid #E8E8E8; border-bottom: 1px solid #E8E8E8; background: #FFFFFF;" onclick="goUserShop();">
			<img src="ico/ico_more_444.png" style="max-height: 16px; margin-top: 12px; float: right; margin-right: 10px;" />
			<img src="ico/ico_shop_8a.png" style="max-height: 20px; margin-top: 10px; float: left; margin-left: 10px;" />
			<div style="width: auto; height: 40px; line-height: 40px; font-size: 14px; float: left; margin-left: 10px;">店铺</div>
		</div>
		<div id="div_shopContent">
			<!--<table><tr>
				<td class="tdShopCover">&nbsp;</td>
				<td class="tdShopCover">&nbsp;</td>
				<td class="tdShopCover">&nbsp;</td>
			</tr></table>-->
		</div>
		

		<div style="width: 100%; height: 40px; margin-top: 5px; border-top: 1px solid #E8E8E8; border-bottom: 1px solid #E8E8E8; background: #FFFFFF;" onclick="goUserCircle();">
			<!--<img src="ico/ico_more_444.png" style="max-height: 16px; margin-top: 12px; float: right; margin-right: 10px;" />-->
			<img src="ico/ico_circle.png" style="max-height: 20px; margin-top: 10px; float: left; margin-left: 10px;" />
			<div style="width: auto; height: 40px; line-height: 40px; font-size: 14px; float: left; margin-left: 10px;">圈子</div>
		</div>
		<div id="div_circleContent">
			<!--<div class="cssDivSpaceCircle">
				<img src="img/goods.jpg" />
				<div>sdffs</div>
			</div>-->
		</div>
		
	</body>
</html>

<script>
	var userId=GetUrlParam("userId");
	var token=GetUrlParam("token");
	var shareTitle="";
	var shareContent="绿豆芽用户空间分享";
	var shareUrl="http://www.lvdoya.com/H5/user_space.html?userId="+userId;
	var shareImgUrl="";
	
	function goUserCarbonShop(){
		var newUrl="http://www.lvdoya.com/H5/carbon_userShop.html?token="+token+"&userId="+userId;
		aif.javaOpenNewWindow(newUrl);
	}
	
	function goUserShop(){
		window.location="mall_shop.html?token="+token+"&userid="+userId;
	}
	
	function go_saler_java(userId,userNickname){
		aif.javaGoSaler(userId,userNickname);
	}
	
	function go_addFriend(userId){
		aif.javaAddFriend(userId);
	}
	
	function goCircle(circleId){
		aif.javaGoCircleForGame(circleId);
	}
	
	function shareSdk(){
		aif.javaShare(shareTitle,shareContent,shareUrl,shareImgUrl);
	}
	
	function go_back(){
		aif.javaCloseActivity();
	}
	
	function go_goods(goodsId){		
		var newUrl="http://www.lvdoya.com/H5/mall_goods.html?token="+token+"&goodsId="+goodsId;
		aif.javaGoGoods(newUrl);
	}
	
	function go_userProject(ccerNumber,ccerName){
		var newUrl="http://www.lvdoya.com/H5/carbon_userProject.html?ccerNumber="+ccerNumber+"&ccerName="+escape(ccerName)+"&token="+token+"&userId="+userId;
		aif.javaOpenNewWindow(newUrl);
	}
	
	function init(){
		loadUserInfo();
		loadUserShop();
		loadUserCircle();
	}
	
	function loadUserInfo(){
		//查询用户碳铺信息，其中包括用户信息
		$.ajax	
		({
			type : "POST",url:"http://114.55.103.71:9006/ldy/cstore/getCcerStoreByUserid?callback=?&searchText=&userid="+userId+"&token="+token,data: {},dataType : "jsonp",	
			success : function(data) 
			{   
				var json = eval(data); 	
				if (json.code==200){
					if (parseInt(json.data.xyz)>0){
						$("#div_creditUser").html("+"+json.data.xyz);
					} else if (parseInt(json.data.xyz)<0){
						$("#div_creditUser").html(json.data.xyz);
					} else if (parseInt(json.data.xyz)==0){
						$("#div_creditUser").html("0");
					}
					$("#divUserNickname").html(json.data.userNname);
//					$("#imgUserlogo").attr("src",json.data.userLogo);
					console.log(json.data.userLogo);
					
					if (json.data.tj_list){	//如果有设置推荐则显示
						var result="";
						result+="<table width='100%' border='0' cellspacing='0' cellpadding='0'><tr>";
						result+="<td class='td_carbonStamp' onclick='go_userProject(&apos;"+json.data.tj_list[0].c_number+"&apos;,&apos;"+json.data.tj_list[0].c_title+"&apos;);'>";
						result+="<div class='div_carbonStampImg' id='div_carbonStampLeft'>";
						result+="<img src='"+json.data.tj_list[0].c_img+"' />";
						result+="<div class='div_carbonStampBgBottom'></div>";
						result+="<div class='div_carbonStampTitle' id='div_carbonStampTitleLeft'>"+json.data.tj_list[0].c_title+"</div>";
						result+="<div class='div_carbonStampNumberType'>";
						result+="<font class='font_carbonStampNumber' id='font_carbonStampNumberLeft'>"+json.data.tj_list[0].c_number+"</font>";
						result+="<font class='font_carbonStampType' id='font_carbonStampTypeLeft'>"+json.data.tj_list[0].c_type+"</font></div></div>";
						result+="<div class='div_carbonStampAmount'>";
						result+="<div class='div_carbonStampBuySale'>转让:<font class='font_carbonStampBuyAmount' id='font_carbonStampBuyAmountLeft'>"+json.data.tj_list[0].sale_num+"</font>吨</div>";
						result+="<div class='div_carbonStampBuySale'>收购:<font class='font_carbonStampSaleAmount' id='font_carbonStampBuyAmountLeft'>"+json.data.tj_list[0].buy_num+"</font>吨</div></div></td>";
						if (json.data.tj_list.length==2){
							result+="<td class='td_carbonStamp' onclick='go_userProject(&apos;"+json.data.tj_list[1].c_number+"&apos;,&apos;"+json.data.tj_list[1].c_title+"&apos;);'>";
							result+="<div class='div_carbonStampImg' id='div_carbonStampLeft'>";
							result+="<img src='"+json.data.tj_list[1].c_img+"' />";
							result+="<div class='div_carbonStampBgBottom'></div>";
							result+="<div class='div_carbonStampTitle' id='div_carbonStampTitleLeft'>"+json.data.tj_list[1].c_title+"</div>";
							result+="<div class='div_carbonStampNumberType'>";
							result+="<font class='font_carbonStampNumber' id='font_carbonStampNumberLeft'>"+json.data.tj_list[1].c_number+"</font>";
							result+="<font class='font_carbonStampType' id='font_carbonStampTypeLeft'>"+json.data.tj_list[1].c_type+"</font></div></div>";
							result+="<div class='div_carbonStampAmount'>";
							result+="<div class='div_carbonStampBuySale'>转让:<font class='font_carbonStampBuyAmount' id='font_carbonStampBuyAmountLeft'>"+json.data.tj_list[1].sale_num+"</font>吨</div>";
							result+="<div class='div_carbonStampBuySale'>收购:<font class='font_carbonStampSaleAmount' id='font_carbonStampBuyAmountLeft'>"+json.data.tj_list[1].buy_num+"</font>吨</div></div></td>";							
						} else {
							result+="<td>&nbsp;</td></tr></table>"
						}
					}
					$("#divCarbonShopContent").html(result);
				}
				else
				{
					$("#loadingToast").css("display","none");
					jectNotice(json.msg);
				}
			},
			error : function(textStatus) 
			{
				$("#loadingToast").css("display","none");
			}
		});			
	}
	
	
	function loadUserShop(){
		$.ajax	//店铺信息
		({
			type : "POST",url:"http://114.55.103.71:9006/ldy/store/getStoreByUserid?callback=?&userid="+userId,data: {},dataType : "jsonp",	//取店铺数据
			success : function(data) 
			{   
				var json = eval(data); 	
				if (json.code==200){
					var result="";
					if (json.data.tj_list){
						switch (json.data.tj_list.length){
							case 1:
								result+="<table style='width: 100%;'><tr><td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[0].spId+"&apos;);'>"+json.data.tj_list[0].coverImg+"</td>";
								result+="<td class='tdShopCover'>&nbsp;</td><td class='tdShopCover'>&nbsp;</td></tr></table>";
							break;
							case 2:
								result+="<table style='width: 100%;'><tr><td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[0].spId+"&apos;);'>"+json.data.tj_list[0].coverImg+"</td>";
								result+="<td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[1].spId+"&apos;);'>"+json.data.tj_list[1].coverImg+"</td><td class='tdShopCover'>&nbsp;</td></tr></table>";
							break;
							case 3:
								result+="<table style='width: 100%;'><tr><td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[0].spId+"&apos;);'>"+json.data.tj_list[0].coverImg+"</td>";
								result+="<td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[1].spId+"&apos;);'>"+json.data.tj_list[1].coverImg+"</td>";
								result+="<td class='tdShopCover' onclick='go_goods(&apos;"+json.data.tj_list[2].spId+"&apos;);'>"+json.data.tj_list[2].coverImg+"</td></tr></table>";
							break;
						}
						$("#div_shopContent").html(result);
						var windowWidth=$(window).width();
						var tdWidth=windowWidth/3;
						$(".tdShopCover").css("width",tdWidth+"px");
						$(".tdShopCover").css("height",tdWidth+"px");
						$(".img_goodsFace").css("width",tdWidth-10+"px");
						$(".img_goodsFace").css("height",tdWidth-10+"px");					
					}
				}
				else
				{
					$("#loadingToast").css("display","none");
//					alert(json.code);
				}
			},
			error : function(textStatus) 
			{
			}
		});			
	}
	
	function loadUserCircle(){
		$.ajax	//查用户圈子，其中包括是否是好友，包括用户信息
		({
			type : "POST",url:"http://114.55.103.71:9006/ldy/usc/getUserSpaceToJSON?callback=?&userId="+userId+"&token="+token,data: {},dataType : "jsonp",	
			success : function(data) 
			{   
				var json = eval(data); 	
				if (json.code==200){
					if (json.data.isFriendAdd==true){
						$("#divSpaceAddFriend").css("display","none");
					} else {
						$("#divSpaceAddFriend").css("display","block");
					}
					
					//为发消息添加点击事件
					$("#divChat").attr("onclick","go_saler_java('"+json.data.user_id+"','"+json.data.user_nickname+"');");
					//为加好友添加点击事件
					$("#divSpaceAddFriend").attr("onclick","go_addFriend('"+json.data.user_id+"');");
					//添加分享参数
					shareTitle=json.data.user_nickname+"的空间";
					shareImgUrl=json.data.user_logo;
					
					$("#imgUserlogo").attr("src",json.data.user_logo);
					console.log(json.data.user_logo);
					
					var result="";
					if (json.data.cirs){
						for (var i=0; i<json.data.cirs.length; i++){
							result+="<div class='cssDivSpaceCircle' onclick='goCircle(&apos;"+json.data.cirs[i].circle_id+"&apos;);'>";
							result+="<img src='"+json.data.cirs[i].circle_logo+"' />";
							result+="<div class='cssDivSpaceCircleName'>"+json.data.cirs[i].circle_name+"</div>";
							if (json.data.cirs[i].circle_memberCount>200){
								result+="<div class='cssDivSpaceCircleMebmer'>(200/200)</div></div>";	
							} else {
								result+="<div class='cssDivSpaceCircleMebmer'>("+json.data.cirs[i].circle_memberCount+"/200)</div></div>";
							}
						}
					}
					$("#div_circleContent").html(result);
				}
				else
				{
					$("#loadingToast").css("display","none");
//					alert(json.code)
				}
			},
			error : function(textStatus) 
			{
			}
		});			
	}
</script>
