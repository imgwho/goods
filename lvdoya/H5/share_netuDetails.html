<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
	</head>
	<link rel="stylesheet" type="text/css" href="css/weui.css">
	<script type="text/javascript" src="js/jquery-3.1.1.min.js" ></script>
	<script type="text/javascript" src="js/iscroll-probe.js"></script>
	<script src="js/functionPublic.js"></script>
	</head>
	<style>
		body{
			background: #F2F2F0;
			font-family: sans-serif;
		}
		
		.tableBottom {
			position:fixed;
			bottom:0px;
			border-top:1px solid #ccc;
			background-color:#f8f8f8;
			z-index:7777;
		}
		.tableBottom td {
			width:50%;
			height:50px;
			vertical-align:middle;
			text-align:center;
			font-size:14px;
			color:#333;
		}
		.tableBottom img {
			max-width:20px;
			vertical-align:middle;
			margin-right:10px;
		}			
		.div_netuCover{
			width: 100%; text-align: center; background: #FFFFFF;
		}
		.div_netuCover img{
			width: 60%;
		}
		.div_userLogo img{
			border-radius: 50%; width: 30px; height: 30px; margin-top: 10px;
		}
	</style>
	<body onload="init();">
		<img id="img_share" src="" width="0" height="0" />
		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="height:45px; background-color:#1AAD19; position:fixed; top:0px; z-index:8888;">
			<tr>
				<td style="width:40px; text-align:center;" onclick="closeCurrent()">
					<!--<img src="ico/ico_back.png" style="max-width:26px; margin-top: 7px;" />-->&nbsp;
				</td>
				<td id="td_shopName" style="text-align:center; font-size:16px; color:#fff;">碳中和</td>
				<td id="td_shopShare" style="width:40px; text-align:center; font-size:12px; color:#fff;">&nbsp;</td>
			</tr>
		</table>
		<div style="width: 100%; height: 50px;"></div>
		<div id="div_netuCover" class="div_netuCover"></div>
		<div style="width: 100%;">
			<div id="div_netuTitle" style="margin: 0px 10px 0px 10px; font-size: 16px; font-weight: bold; height: 50px; line-height: 50px; overflow: hidden; background: #f0f0f2;"></div>
		</div>
		
		<div style="width: 100%; height: 50px; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div style="float: left; margin-left: 10px; height: 50px; line-height: 50px; font-size: 14px;">发起人</div>
			<div id="div_userLogo" class="div_userLogo" style="float: left; margin-left: 10px;"></div>
			<div id="div_userNickname" style="float: left; margin-left: 3px; height: 50px; line-height: 50px; font-size: 14px;"></div>
		</div>			
		
		<div id="div_codeFather" style="width: 100%; height: 40px; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div style="width: auto; height: 40px; line-height: 40px; float: left; margin-left: 10px; font-size: 14px;">减排口令</div>
			<div id="div_netuCode" style="width: auto; height: 40px; line-height: 40px; float: left; margin-left: 10px; font-size: 18px; color: #FF9900; font-weight: bold;"></div>
		</div>
		<div style="width: 100%; height: 40px; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div style="width: auto; height: 40px; line-height: 40px; font-size: 14px; margin-left: 10px; float: left; color: #979797;">计划中和:</div>
			<div id="div_planNetu" style="width: auto; height: 40px; line-height: 40px; font-size: 16px; margin-left: 10px; float: left;"></div>
		</div>		
		
		<div style="width: 100%; height: 40px; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div style="width: auto; height: 40px; line-height: 40px; font-size: 14px; margin-left: 10px; float: left; color: #979797;">已&nbsp;&nbsp;中&nbsp;&nbsp;和:</div>
			<div id="div_doneNetu" style="width: auto; height: 40px; line-height: 40px; font-size: 16px; margin-left: 10px; float: left;"></div>
		</div>	
		
		<div style="width: 100%; height: 30px; line-height: 30px;">
			<font style="margin-left: 10px; font-size: 12px;">中和碳项目</font>
		</div>
		<div style="width: 100%; height: 40px; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div id="div_netuProject" style="width: auto; height: 40px; line-height: 40px; margin-left: 10px; float: left; overflow: hidden; font-size: 14px;"></div>
		</div>	
		
		<div style="width: 100%; height: 30px; line-height: 30px;">
			<font style="margin-left: 10px; font-size: 12px;">中和描述</font>
		</div>
		<div style="width: 100%; background: #FFFFFF; border-bottom: 1px solid #E8E8E8;">
			<div id="div_netuInfo" style="width: auto; line-height: 28px; margin-left: 10px; margin-right: 10px; font-size: 14px; word-break: break-word;"></div>
		</div>			
		
		<div style="width: 100%; height: 60px;"></div>
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="tableBottom">
		  <tr>
		    <td onclick="goApp();" style="border-right:1px solid #ccc;">进入绿豆芽APP参与碳中和</td>	    
		  </tr>
		</table>	
		
	</body>
</html>

<!--============================================================================================================-->
<div id="loadingToast" class="weui_loading_toast" style="display:none; z-index:999999;">
    <div class="weui_mask_transparent"></div>
    <div class="weui_toast">
        <div class="weui_loading">
            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
        </div>
        <p id="p_loadContent" class="weui_toast_content">正在加载</p>
    </div>
</div>
<!--============================================================================================================-->

<script>
	token=GetUrlParam("token");
	netuId=GetUrlParam("netuId");
	fromPage=GetUrlParam("fromPage");
	
	var shareTitle="";
	var shareContent="";
	var shareUrl="";
	var shareImgUrl="";	
	
	function init(){
		$("#loadingToast").css("display","block");
		if (fromPage=="other"){
			$("#div_codeFather").css("display","none");
		} else if (fromPage=="mine"){
			$("#div_codeFather").css("display","block");
		}
		loadDetails();
	}
	
	function closeCurrent(){
		aif.javaCloseActivity();
	}
	
	function typeNetuCode(){
		aif.javaToastNotice("即将开放");
	}
	
	function goUserSpace(userId){
		var newUrl="http://www.lvdoya.com/H5/user_space.html?token="+token+"&userId="+userId;
		aif.javaOpenNewWindow(newUrl);
	}
	
	function goCarbonInfo(ccerNumber){
		var newUrl="http://www.lvdoya.com/H5/carbon_info.html?ccerNumber="+ccerNumber;
		aif.javaOpenNewWindow(newUrl);		
	}
	
	function goNameList(netuId){
		var newUrl="http://www.lvdoya.com/H5/netu_nameList.html?token="+token+"&netuId="+netuId;
		aif.javaOpenNewWindow(newUrl);
	}
	
	function loadDetails(){
		$.ajax	
		({
			type : "POST",url:"http://114.55.103.71:9006/ldy/neutral/getNeutralById?callback=?&neutralId="+netuId,data: {},dataType : "jsonp",	
			success : function(data) 
			{   
				var json = eval(data); 	
				if (json.code==200){
//					$("#div_netuCover").html(json.data.n_img);
					var coverImgString=json.data.n_img;
					coverImgString=coverImgString.replace("/>","");
					coverImgString+=" id='img"+netuId+"' />"
					$("#div_netuCover").html(coverImgString);
					$("#div_netuTitle").html(json.data.n_title);
					document.title=json.data.n_title;
					$("#div_planNetu").html(parseFloat(json.data.sl).toFixed(2)+"吨");
					$("#div_doneNetu").html(parseFloat(json.data.completed_count).toFixed(2)+"吨");
					$("#div_netuInfo").html(json.data.n_info);
					$("#div_netuCode").html(json.data.code);
					$("#div_userLogo").html("<img src='"+json.data.user_logo+"' />")
					$("#div_userNickname").html(json.data.user_nickname);
					$("#div_netuProject").html("("+json.data.cnumber+")"+json.data.c_title);
					
					$("#div_userLogo").attr("onclick","goUserSpace('"+json.data.userId+"');");
					$("#div_userNickname").attr("onclick","goUserSpace('"+json.data.userId+"');");
					$("#div_netuProject").attr("onclick","goCarbonInfo('"+json.data.cnumber+"');");
					$("#td_viewNameList").attr("onclick","goNameList('"+json.data.neutralId+"');");
					
					$("#loadingToast").css("display","none");
					
					//为分享添加参数
					shareTitle="'"+json.data.user_nickname+"'在绿豆芽发起了"+parseFloat(json.data.sl).toFixed(2)+"吨碳中和-"+json.data.n_title;
					shareContent=json.data.n_info;
					shareUrl="http://www.lvdoya.com/H5/share_netuDetails.html?&netuId="+netuId+"&fromPage=other";
					shareImgUrl=$("#img"+netuId)[0].src;	
					$("#img_share").attr("src",shareImgUrl);
				}
				else
				{
					$("#loadingToast").css("display","none");
					jectNotice(json.msg);
				}
			},
			error : function(textStatus) 
			{
				$("#loadingToast").css("display","none");
			}
		});	
	}
	
	
	function goApp(){
		var ua = navigator.userAgent.toLowerCase();	
		if (/iphone|ipad|ipod/.test(ua)) {
			    window.location="https://itunes.apple.com/cn/app/%E7%BB%BF%E8%B1%86%E8%8A%BD-%E9%87%91%E5%B1%B1%E9%93%B6%E5%B1%B1/id1184767071?l=zh&ls=1&mt=8";
		} else if (/android/.test(ua)) {
			    window.location="http://app.qq.com/#id=detail&appid=1106034858";
		}		
	}
</script>

<script type="text/javascript"> 

document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() { 
// 发送给好友 
WeixinJSBridge.on('menu:share:appmessage', function (argv) { 
WeixinJSBridge.invoke('sendAppMessage', { 
"appid": "123", 
"img_url": img, 
"img_width": "160", 
"img_height": "160", 
"link": link, 
"desc": con, 
"title": tit 
}, function (res) { 
_report('send_msg', res.err_msg); 
}) 
}); 

// 分享到朋友圈 
WeixinJSBridge.on('menu:share:timeline', function (argv) { 
WeixinJSBridge.invoke('shareTimeline', { 
"appid": "wxfc0b45dd13a2800a",
"img_url": shareImgUrl, 
"img_width": "160", 
"img_height": "160", 
"link": shareUrl, 
"desc": shareContent, 
"title": shareTitle 
}, function (res) { 
_report('timeline', res.err_msg); 
}); 
}); 
}, false) 
</script> 
